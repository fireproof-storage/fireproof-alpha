{"version":3,"sources":["../src/config.js","import.js"],"names":["_core","require","_fs","_path","_core2","config","dataDir","loadDatabase","database","clock","loadClock","Error","Fireproof","storage","clockFile","join","JSON","parse","readFileSync","err","loadData","filename","fullFilePath","process","cwd","readableStream","createReadStream","parseStream","pipe","on","data","ok","put","console","log","_react","_interopRequireWildcard","_propTypes","_interopRequireDefault","_ink","_config","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","Import","stage","setStage","useState","db","setDb","loadFile","useCallback","initDatabase","useEffect","createElement","Text","propTypes","PropTypes","string","isRequired","positionalArgs","_default","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,GAAA,GAAAD,OAAA;AACA,IAAAE,KAAA,GAAAF,OAAA;AACA,IAAAG,MAAA,GAAAH,OAAA;AAEA,MAAMI,MAAM,GAAG;EACbC,OAAO,EAAE;AACX,CAAC;AAEM,SAASC,YAAYA,CAAEC,QAAQ,EAAE;EACtC,MAAMC,KAAK,GAAGC,SAAS,CAACF,QAAQ,CAAC;EACjC,IAAIC,KAAK,EAAE;IACT,MAAM,IAAIE,KAAK,CAAE,YAAWH,QAAS,iBAAgB,CAAC;EACxD,CAAC,MAAM;IACL,OAAOI,eAAS,CAACC,OAAO,CAACL,QAAQ,CAAC;EACpC;AACF;AAEA,SAASE,SAASA,CAAEF,QAAQ,EAAE;EAC5B,MAAMM,SAAS,GAAG,IAAAC,UAAI,EAACV,MAAM,CAACC,OAAO,EAAEE,QAAQ,EAAE,YAAY,CAAC;EAC9D,IAAIC,KAAK;EACT,IAAI;IACFA,KAAK,GAAGO,IAAI,CAACC,KAAK,CAAC,IAAAC,gBAAY,EAACJ,SAAS,EAAE,MAAM,CAAC,CAAC;EACrD,CAAC,CAAC,OAAOK,GAAG,EAAE;IACZV,KAAK,GAAG,IAAI;EACd;EACA,OAAOA,KAAK;AACd;AAEO,SAASW,QAAQA,CAAEZ,QAAQ,EAAEa,QAAQ,EAAE;EAC5C,MAAMC,YAAY,GAAG,IAAAP,UAAI,EAACQ,OAAO,CAACC,GAAG,EAAE,EAAEH,QAAQ,CAAC;EAClD,MAAMI,cAAc,GAAG,IAAAC,oBAAgB,EAACJ,YAAY,CAAC;EACrD,MAAMK,WAAW,GAAG,IAAAV,YAAK,GAAE;EAC3BQ,cAAc,CAACG,IAAI,CAACD,WAAW,CAAC;EAChCA,WAAW,CAACE,EAAE,CAAC,MAAM,EAAE,MAAOC,IAAI,IAAK;IACrC,MAAMC,EAAE,GAAG,MAAMvB,QAAQ,CAACwB,GAAG,CAACF,IAAI,CAAC;IACnCG,OAAO,CAACC,GAAG,CAAC,KAAK,EAAEH,EAAE,CAAC;EACxB,CAAC,CAAC;AACJ;;;;;;;;ACtCA,IAAAI,MAAA,GAAAC,uBAAA,CAAAnC,OAAA;AACA,IAAAoC,UAAA,GAAAC,sBAAA,CAAArC,OAAA;AACA,IAAAsC,IAAA,GAAAtC,OAAA;AAEA,IAAAuC,OAAA,GAAAvC,OAAA;AAAyD,SAAAqC,uBAAAG,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAAA,SAAAG,yBAAAC,WAAA,eAAAC,OAAA,kCAAAC,iBAAA,OAAAD,OAAA,QAAAE,gBAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,WAAA,WAAAA,WAAA,GAAAG,gBAAA,GAAAD,iBAAA,KAAAF,WAAA;AAAA,SAAAT,wBAAAK,GAAA,EAAAI,WAAA,SAAAA,WAAA,IAAAJ,GAAA,IAAAA,GAAA,CAAAC,UAAA,WAAAD,GAAA,QAAAA,GAAA,oBAAAA,GAAA,wBAAAA,GAAA,4BAAAE,OAAA,EAAAF,GAAA,UAAAQ,KAAA,GAAAL,wBAAA,CAAAC,WAAA,OAAAI,KAAA,IAAAA,KAAA,CAAAC,GAAA,CAAAT,GAAA,YAAAQ,KAAA,CAAAE,GAAA,CAAAV,GAAA,SAAAW,MAAA,WAAAC,qBAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,GAAA,IAAAhB,GAAA,QAAAgB,GAAA,kBAAAH,MAAA,CAAAI,SAAA,CAAAC,cAAA,CAAAC,IAAA,CAAAnB,GAAA,EAAAgB,GAAA,SAAAI,IAAA,GAAAR,qBAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAf,GAAA,EAAAgB,GAAA,cAAAI,IAAA,KAAAA,IAAA,CAAAV,GAAA,IAAAU,IAAA,CAAAC,GAAA,KAAAR,MAAA,CAAAC,cAAA,CAAAH,MAAA,EAAAK,GAAA,EAAAI,IAAA,YAAAT,MAAA,CAAAK,GAAA,IAAAhB,GAAA,CAAAgB,GAAA,SAAAL,MAAA,CAAAT,OAAA,GAAAF,GAAA,MAAAQ,KAAA,IAAAA,KAAA,CAAAa,GAAA,CAAArB,GAAA,EAAAW,MAAA,YAAAA,MAAA;AAEzD;AACA,MAAMW,MAAM,GAAGA,CAAC;EAAEvD,QAAQ;EAAEa;AAAS,CAAC,KAAK;EACzC,MAAM,CAAC2C,KAAK,EAAEC,QAAQ,CAAC,GAAG,IAAAC,eAAQ,EAAC,cAAc,CAAC;EAClD,MAAM,CAACC,EAAE,EAAEC,KAAK,CAAC,GAAG,IAAAF,eAAQ,EAAC,IAAI,CAAC;EAElC,MAAMG,QAAQ,GAAG,IAAAC,kBAAW,EAAC,MAAM;IACjCL,QAAQ,CAAC,WAAW,CAAC;IACrB,IAAA7C,gBAAQ,EAACZ,QAAQ,EAAEa,QAAQ,CAAC;EAC9B,CAAC,EAAE,CAACA,QAAQ,CAAC,CAAC;EAEd,MAAMkD,YAAY,GAAG,IAAAD,kBAAW,EAAC,MAAM;IACrC;IACA;IACAL,QAAQ,CAAC,SAAS,CAAC;IACnBG,KAAK,CAAC,IAAA7D,oBAAY,EAACC,QAAQ,CAAC,CAAC;EAC/B,CAAC,EAAE,CAACA,QAAQ,CAAC,CAAC;EAEd,IAAAgE,gBAAS,EAAC,MAAM;IACd,IAAIL,EAAE,EAAE;MAAEE,QAAQ,EAAE;IAAC;EACvB,CAAC,EAAE,CAACF,EAAE,CAAC,CAAC;EAER,IAAAK,gBAAS,EAAC,MAAM;IACdD,YAAY,EAAE;EAChB,CAAC,EAAE,EAAE,CAAC;EAEN,oBAAOpC,MAAA,CAAAQ,OAAA,CAAA8B,aAAA,CAAClC,IAAA,CAAAmC,IAAI,QAAC,YAAU,EAACrD,QAAQ,EAAC,MAAI,EAACb,QAAQ,EAAC,WAAS,EAACwD,KAAK,CAAQ;AACxE,CAAC;AAEDD,MAAM,CAACY,SAAS,GAAG;EACjB;EACAnE,QAAQ,EAAEoE,kBAAS,CAACC,MAAM,CAACC,UAAU;EACrC;EACAzD,QAAQ,EAAEuD,kBAAS,CAACC,MAAM,CAACC;AAC7B,CAAC;AACDf,MAAM,CAACgB,cAAc,GAAG,CAAC,UAAU,EAAE,UAAU,CAAC;AAAA,IAAAC,QAAA,GAEjCjB,MAAM;AAAAkB,OAAA,CAAAtC,OAAA,GAAAqC,QAAA","file":"import.js","sourceRoot":"../../commands","sourcesContent":["import { Fireproof } from '@fireproof/core'\nimport { readFileSync, createReadStream } from 'fs'\nimport { join } from 'path'\nimport { parse } from '@jsonlines/core'\n\nconst config = {\n  dataDir: '~/.fireproof'\n}\n\nexport function loadDatabase (database) {\n  const clock = loadClock(database)\n  if (clock) {\n    throw new Error(`Database ${database} already exists`)\n  } else {\n    return Fireproof.storage(database)\n  }\n}\n\nfunction loadClock (database) {\n  const clockFile = join(config.dataDir, database, 'clock.json')\n  let clock\n  try {\n    clock = JSON.parse(readFileSync(clockFile, 'utf8'))\n  } catch (err) {\n    clock = null\n  }\n  return clock\n}\n\nexport function loadData (database, filename) {\n  const fullFilePath = join(process.cwd(), filename)\n  const readableStream = createReadStream(fullFilePath)\n  const parseStream = parse()\n  readableStream.pipe(parseStream)\n  parseStream.on('data', async (data) => {\n    const ok = await database.put(data)\n    console.log('put', ok)\n  })\n}\n","import React, { useState, useEffect, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport { Text } from 'ink'\n\nimport { loadDatabase, loadData } from '../src/config.js'\n\n/// Import data into a database\nconst Import = ({ database, filename }) => {\n  const [stage, setStage] = useState('initializing')\n  const [db, setDb] = useState(null)\n\n  const loadFile = useCallback(() => {\n    setStage('importing')\n    loadData(database, filename)\n  }, [filename])\n\n  const initDatabase = useCallback(() => {\n    // use the database name to see if there is a directory in the root directory with that name\n    // if not, create it\n    setStage('loading')\n    setDb(loadDatabase(database))\n  }, [database])\n\n  useEffect(() => {\n    if (db) { loadFile() }\n  }, [db])\n\n  useEffect(() => {\n    initDatabase()\n  }, [])\n\n  return <Text>Importing {filename} to {database}. Stage: {stage}</Text>\n}\n\nImport.propTypes = {\n  /// Name of the database to use, will create if necessary\n  database: PropTypes.string.isRequired,\n  /// Path to a JSON file to import\n  filename: PropTypes.string.isRequired\n}\nImport.positionalArgs = ['database', 'filename']\n\nexport default Import\n"]}